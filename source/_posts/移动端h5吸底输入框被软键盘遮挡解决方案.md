---
title: 移动端h5吸底输入框被软键盘遮挡解决方案
date: 2018-05-17 14:04:48
tags: [前端兼容性]
categories: 前端
id: 3
---
在移动web页面中，很容易遇到，位于页面底部的输入框，在获取焦点时，被弹起的软键盘遮挡的情况。近期的一个项目就面对了这样一个问题。

#### 我们需要做的一个页面，视觉是这样的：
![](/images/3/layout.png)

可选择的布局方案有很多种，我最终选择了flex布局，使输入框固定于页面底部。因为使用fixed定位会带来键盘弹起后输入框无法复位的兼容性问题，而使用absolute布局又需要手动计算聊天区域内容高度（100vh-输入框区域高度），相比之下flex布局写法简洁一些。

写完后，如果不做任何处理，我们会发现，在部分ios手机上，使用第三方输入法，软键盘弹起时，会把输入框遮住。

于是，我们进行了下列处理：

#### 第一阶段
键盘弹起后设置定时器，反复执行下面代码：

```js
const inputElement = document.querySelector('input');
inputElement.scrollIntoView(true);  //元素的顶端与可视区域的顶端对齐
inputElement.scrollIntoViewIfNeeded();
```
或把以上代码换为:
```js
document.body.scrollTop = document.body.scrollHeight;
```

对以上代码进行测试，结果发现：
IOS系统版本在11.0（>=11.0） - 11.3（<11.3）之间的手机，输入框都完全被软键盘遮挡（包括系统键盘和第三方键盘）。IOS系统版本不在此范围内的手机，以及安卓手机，使用自带键盘或第三方键盘，均未发现问题。 
原因解释：
IOS11.0-11.3 对scrolIntoView及scrollTop的解释有bug，直接执行会导致输入框滚到底部被遮挡。

#### 第二阶段
发现当键盘弹起后不做任何处理时，IOS11.0-11.3的手机的自带输入法的软键盘不会遮挡输入框，但使用第三方输入法的输入框会被遮挡，原因是第三方输入法比IOS自带输入法多了一个toolbar，高度为88px，IOS系统未将其识别为软键盘的高度增加。为了优先兼容自带输入法，我们在代码中做了系统判断，如果手机系统版本在IOS11.0-11.3之间，则js不做任何处理，否则则执行以上强制滚动的代码。

我将以上代码写成了插件形式，代码地址为：https://github.com/nieyt/input-show

后期优化方向： 兼容特殊版本区间的第三方输入法；提高键盘弹出及收起时在观感上的流畅度

#### 其他思考&观察

发现IOS11.0-11.3的手机，键盘弹起时`window.innerHeight`未发生改变。



